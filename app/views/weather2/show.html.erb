
<h2><%= @result[:display_name] %></h2>


<%

def extract_weekday(day)
  datetime = DateTime.parse(day.dig(:dt))
  datetime.strftime("%a")
end

def extract_icon(day)
  day.dig(:weather, 0, :icon_uri)
end

def local_datetime(utc_dt_str, timezone)
  parsed_datetime = DateTime.parse(utc_dt_str)
  desired_time_zone = ActiveSupport::TimeZone[timezone]
  parsed_datetime.in_time_zone(desired_time_zone)
end

now = @weather.dig(:current)
%>


<h3>Current Weather</h3>
<%= local_datetime(now[:dt], @weather[:timezone]).strftime("%A %l:%M %p") %> <em>(local time)</em><br />
<%= now.dig(:weather, 0, :description).humanize %>
<img src=<%= "#{extract_icon(now)}"  %> ></br />

<%= "Temperature: #{now[:temp].to_i} °F"  %><br />
<%= "Humidity: #{now[:humidity].to_i}%"  %><br />
<%= "Wind: #{now[:wind_speed].to_i} mph"  %><br />

<hr />

<h3>Forecast</h3>
<% day = @weather.dig(:daily, 0) %>

 <table>
  <tr>
    <% @weather[:daily].each do |day| %>
      <td>
        <h4><%= extract_weekday(day) %></h4>
        <%= day.dig(:weather, 0, :description).humanize %><br />
        <img src=<%= "#{extract_icon(day)}"  %> ><br />
        Low <%= day.dig(:temp, :min).to_i %>°<br />
        High <%= day.dig(:temp, :max).to_i %>°<br />
      <td />
    <% end %>
  <tr />
<table />

<br />

<% if @weather_cache_hit %>
  <em>Weather data pulled from cache for place id <%= @result[:place_id] %>.</em>
<% else %>
  <em>Weather data _not_ pulled from cache for place id <%= @result[:place_id] %>.</em>
<% end %>
